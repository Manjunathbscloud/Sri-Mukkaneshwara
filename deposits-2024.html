<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fourth Year Deposits (2024-2025) - Sri Mukkanneshwara Associate</title>
    <link rel="stylesheet" href="styles.css">
    <script src="js/auth-utils.js"></script>
    <script>
        (function() {
            // Use new AuthUtils for session validation
            if (window.AuthUtils && window.AuthUtils.isSessionValid()) {
                // Session is valid, continue
                return;
            } else {
                // Clear all session data
                sessionStorage.clear();
                sessionStorage.setItem('returnUrl', window.location.href);
                window.location.href = 'login.html';
            }
        })();
    </script>
</head>
<body>
    <header>
        <h1>Sri Mukkanneshwara Associate</h1>
        <nav>
            <ul>
                <li><a href="index.html">Overview</a></li>
                <li><a href="members.html">Members</a></li>
                <li><a href="accounts.html">Accounts</a></li>
                <li><a href="meetings.html">Meetings</a></li>
                <li><a href="rules.html">Rules</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section class="deposits-section">
            <h2 class="page-title"><i class="fas fa-piggy-bank"></i> Deposits 2024-25</h2>

            <div class="table-actions" style="margin-bottom: 1rem; text-align: right;">
                <button id="downloadPdfBtn" class="download-btn" onclick="downloadDepositPDF()" title="Download as PDF">
                    <i class="fas fa-download"></i> Download PDF
                </button>
            </div>

            <div class="info-card">
                <h3 class="mt-4">Fourth Year History (2024-2025)</h3>
                <div class="history-summary">
                    <p>In the fourth year, the association further enhanced its financial structure:</p>
                    <ul class="feature-list">
                        <li>Yearly renewal fee increased to: ₹6,000 per member</li>
                        <li>Monthly deposit continued at: ₹1,500 per member</li>
                        <li>Additional income: Earned ₹57,300 through interest (until November 2024)</li>
                        <li>Annual expenses: ₹33,385 spent on year-end meeting</li>
                    </ul>
                </div>

                <h3 class="mt-4">Detailed Fourth Year Summary</h3>
                <table class="member-table">
                    <thead>
                        <tr>
                            <th>Description</th>
                            <th>Details</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Renewal Fee</td>
                            <td>April 2024 (₹6,000 × 7 members)</td>
                            <td>₹42,000</td>
                        </tr>
                        <tr>
                            <td>Monthly Deposits</td>
                            <td>April 2024 - November 2024 (₹1,500 × 7 members × 8 months)</td>
                            <td>₹84,000</td>
                        </tr>
                        <tr>
                            <td>Interest Earned</td>
                            <td>Total interest until November 2024</td>
                            <td>₹57,300</td>
                        </tr>
                        <tr>
                            <td>Annual Meeting Expense</td>
                            <td>Year-end meeting cost</td>
                            <td>-₹33,385</td>
                        </tr>
                        <tr class="total-row">
                            <td>Total Balance</td>
                            <td>As of November 2024</td>
                            <td>₹149,915</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <a href="deposits.html" style="color: #007bff; text-decoration: none; font-size: 0.9rem;">
                    ← Back to Deposits Overview
                </a>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 Sri Mukkanneshwara Associate. All rights reserved.</p>
    </footer>
    
    <script src="js/pdf-generator.js"></script>
    <script>
        // PDF Download functionality for deposits
        async function downloadDepositPDF() {
            const downloadBtn = document.getElementById('downloadPdfBtn');
            const originalText = downloadBtn.innerHTML;
            
            try {
                // Show loading state
                downloadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating PDF...';
                downloadBtn.disabled = true;
                
                // Get deposit data from the page
                const depositData = getDepositData();
                
                if (depositData.length === 0) {
                    alert('No data available to generate PDF');
                    return;
                }
                
                // Generate PDF
                const success = await PDFGenerator.generateDepositPDF('2024-25', depositData, 'Deposit Records 2024-25');
                
                if (success) {
                    console.log('PDF generated successfully');
                }
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Error generating PDF. Please try again.');
            } finally {
                // Reset button state
                downloadBtn.innerHTML = originalText;
                downloadBtn.disabled = false;
            }
        }
        
        // Function to get deposit data from the page
        function getDepositData() {
            const depositData = [
                {
                    description: 'Renewal Fee',
                    details: 'April 2024 (₹6,000 × 7 members)',
                    amount: '₹42,000'
                },
                {
                    description: 'Monthly Deposits',
                    details: 'April 2024 - November 2024 (₹1,500 × 7 members × 8 months)',
                    amount: '₹84,000'
                },
                {
                    description: 'Interest Earned',
                    details: 'Total interest until November 2024',
                    amount: '₹57,300'
                },
                {
                    description: 'Annual Meeting Expenses',
                    details: 'Year-end meeting cost',
                    amount: '₹33,385'
                },
                {
                    description: 'Total Balance',
                    details: 'As of November 2024',
                    amount: '₹149,915'
                }
            ];
            
            return depositData;
        }
    </script>
</body>
</html>
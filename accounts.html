<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Accounts - Sri Mukkanneshwara Associate</title>
    <link rel="stylesheet" href="styles.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
</head>
<body>
    <script>
        (function() {
            function hasValidUser() {
                var raw = localStorage.getItem('userDetails') || sessionStorage.getItem('userDetails');
                if (!raw) return false;
                try { var u = JSON.parse(raw); return !!(u && u.id && u.name); } catch(e) { return false; }
            }
            var isAuth = (localStorage.getItem('isAuthenticated') === 'true' || sessionStorage.getItem('isAuthenticated') === 'true') && hasValidUser();
            if (!isAuth) {
                sessionStorage.setItem('returnUrl', window.location.href);
                window.location.href = 'login.html';
            }
        })();
    </script>

    <!-- Auto-logout script -->
    <script>
        (function() {
            let inactivityTimer;
            const INACTIVITY_TIMEOUT = 15 * 60 * 1000; // 15 minutes in milliseconds
            
            // Function to reset the inactivity timer
            function resetInactivityTimer() {
                clearTimeout(inactivityTimer);
                inactivityTimer = setTimeout(logoutUser, INACTIVITY_TIMEOUT);
            }
            
            // Function to logout user
            function logoutUser() {
                // Clear authentication data
                localStorage.removeItem('isAuthenticated');
                localStorage.removeItem('userDetails');
                sessionStorage.removeItem('isAuthenticated');
                sessionStorage.removeItem('userDetails');
                
                // Show logout message
                alert('You have been logged out due to inactivity. Please login again.');
                
                // Redirect to login page
                window.location.href = 'login.html';
            }
            
            // Events that reset the timer
            const events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart', 'click'];
            
            // Add event listeners
            events.forEach(function(event) {
                document.addEventListener(event, resetInactivityTimer, true);
            });
            
            // Start the timer when page loads
            resetInactivityTimer();
            
            // Also reset timer on page visibility change (when user comes back to tab)
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden) {
                    resetInactivityTimer();
                }
            });
        })();
    </script>
    <header>
        <h1>Sri Mukkanneshwara Associate</h1>
        <nav>
            <ul>
                <li><a href="index.html">Overview</a></li>
                <li><a href="members.html">Members</a></li>
                <li><a href="accounts.html">Accounts</a></li>
                <li><a href="meetings.html">Meetings</a></li>
                <li><a href="rules.html">Rules</a></li>
                <li><a href="#" id="logoutBtn" style="color: #e74c3c;"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
            </ul>
        </nav>
    </header>

    <!-- Mobile Header -->
    <div class="mobile-header">
        <h1>Sri Mukkanneshwara Associate</h1>
        <button class="mobile-nav-toggle" onclick="toggleMobileNav()">
            <i class="fas fa-bars"></i>
        </button>
    </div>

    <!-- Mobile Navigation -->
    <div class="mobile-nav" id="mobileNav">
        <button class="mobile-nav-close" onclick="toggleMobileNav()">
            <i class="fas fa-times"></i>
        </button>
            <ul>
                <li><a href="index.html" onclick="toggleMobileNav()">Overview</a></li>
                <li><a href="members.html" onclick="toggleMobileNav()">Members</a></li>
                <li><a href="accounts.html" onclick="toggleMobileNav()">Accounts</a></li>
                <li><a href="meetings.html" onclick="toggleMobileNav()">Meetings</a></li>
                <li><a href="rules.html" onclick="toggleMobileNav()">Rules</a></li>
                <li><a href="#" id="mobileLogoutBtn" onclick="toggleMobileNav()" style="color: #e74c3c;"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
            </ul>
    </div>

    <main>
        <section class="account-overview mobile-dashboard">
            <div style="text-align: center; margin-bottom: 1rem;">
                <button onclick="window.FinancialData.refresh()" 
                        style="background: #007bff; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.9rem;">
                    <i class="fas fa-sync-alt"></i> Refresh Financial Data
                </button>
            </div>
            <div class="account-stats mobile-dashboard-grid">
                <div class="stat-card mobile-dashboard-card">
                    <div class="stat-icon">
                        <i class="fas fa-university"></i>
                    </div>
                    <div class="stat-info">
                        <h4>Current Bank Balance</h4>
                        <span class="stat-value">₹1,83,790</span>
                        <span class="stat-date">As of Sepetember 15th 2025</span>
                    </div>
                </div>
                <div class="stat-card mobile-dashboard-card">
                    <div class="stat-icon">
                        <i class="fas fa-hand-holding-usd"></i>
                    </div>
                    <div class="stat-info">
                        <h4>Available Loan Amount</h4>
                        <span class="stat-value">₹1,75,000</span>
                        <span class="stat-date">For Sepetember 15th 2025</span>
                    </div>
                </div>
            </div>
        </section>

        <section class="deposit-history">
            <div class="info-card history-summary">
                <h3><i class="fas fa-history"></i> Deposit Structure History</h3>
                <div class="history-timeline">
                    <div class="timeline-item">
                        <span class="year">2021-22</span>
                        <p>Initial deposit structure: <strong>₹1,000</strong> per month</p>
                    </div>
                    <div class="timeline-item">
                        <span class="year">2022-24</span>
                        <p>After 1st annual meeting: <strong>₹1,500</strong> per month</p>
                        <p class="note">(Maintained for 3 years)</p>
                    </div>
                    <div class="timeline-item current">
                        <span class="year">2025 onwards</span>
                        <p>Current deposit structure: <strong>₹2,000</strong> per month</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="accounts-section">
            <h2 class="page-title">
                <i class="fas fa-university"></i> 
                Account Services
            </h2>

            <div class="services-container">
                <div class="service-card">
                    <h3><i class="fas fa-university"></i> Quick Access</h3>
                    <p>Access your deposits and loan information</p>
                    <div class="account-buttons">
                        <a href="deposits.html" class="account-btn">
                            <i class="fas fa-piggy-bank"></i>
                            Deposits
                        </a>
                        <a href="loans.html" class="account-btn">
                            <i class="fas fa-hand-holding-usd"></i>
                            Loans
                        </a>
                    </div>
                </div>

                <div class="service-card">
                    <h3><i class="fas fa-money-check-alt"></i> Loan Services</h3>
                    <p>Apply for loans or check your existing loan status</p>

                    <div class="action-buttons">
                        <button class="apply-loan-btn" onclick="window.location.href='loan-application.html'">
                            <i class="fas fa-hand-holding-usd"></i>
                            Apply for Loan
                        </button>
                        <button class="view-loans-btn" onclick="window.location.href='loan-status.html'">
                            <i class="fas fa-list-ul"></i>
                            View Loan Status
                        </button>
                        <!-- Review Applications button hidden by default -->
                        <button class="admin-loan-btn" style="display:none;">
                            <i class="fas fa-tasks"></i>
                            Review Applications
                        </button>
                    </div>
                </div>

                <!-- Admin Tools - Only visible to President -->
                <div class="service-card" id="adminToolsCard" style="display: none;">
                    <h3><i class="fas fa-cog"></i> Admin Tools <span class="president-badge">President Only</span></h3>
                    <p>Manage financial data and system settings</p>

                    <div class="action-buttons">
                        <button class="admin-financial-btn" onclick="window.location.href='admin-financial.html'">
                            <i class="fas fa-calculator"></i>
                            Update Financial Data
                        </button>
                        <button class="admin-settings-btn" onclick="alert('Settings page coming soon!')">
                            <i class="fas fa-cogs"></i>
                            System Settings
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 Sri Mukkanneshwara Associate. All rights reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const isPresident = (localStorage.getItem('isPresident') === 'true') || (sessionStorage.getItem('isPresident') === 'true');
            const reviewBtn = document.querySelector('.admin-loan-btn');

            if (isPresident && reviewBtn) {
                reviewBtn.style.display = 'inline-block';
                reviewBtn.onclick = function () {
                    window.location.href = 'president-view.html';
                };
            }

            // Logout functionality
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Clear all authentication data
                    localStorage.removeItem('isAuthenticated');
                    localStorage.removeItem('userEmail');
                    localStorage.removeItem('userName');
                    localStorage.removeItem('memberId');
                    localStorage.removeItem('userPhone');
                    localStorage.removeItem('role');
                    localStorage.removeItem('userDetails');
                    localStorage.removeItem('isPresident');
                    
                    sessionStorage.removeItem('isAuthenticated');
                    sessionStorage.removeItem('userEmail');
                    sessionStorage.removeItem('userName');
                    sessionStorage.removeItem('memberId');
                    sessionStorage.removeItem('userPhone');
                    sessionStorage.removeItem('role');
                    sessionStorage.removeItem('userDetails');
                    sessionStorage.removeItem('isPresident');
                    
                    // Redirect to login page
                    window.location.href = 'login.html';
                });
            }
        });

        // Mobile Navigation Functions
        function toggleMobileNav() {
            const mobileNav = document.getElementById('mobileNav');
            mobileNav.classList.toggle('active');
        }

        // Close mobile nav when clicking outside
        document.addEventListener('click', function(event) {
            const mobileNav = document.getElementById('mobileNav');
            const mobileNavToggle = document.querySelector('.mobile-nav-toggle');
            
            if (!mobileNav.contains(event.target) && !mobileNavToggle.contains(event.target)) {
                mobileNav.classList.remove('active');
            }
        });

        // Role-based access control
        function checkUserRole() {
            try {
                const userDetails = JSON.parse(localStorage.getItem('userDetails') || sessionStorage.getItem('userDetails') || '{}');
                const userRole = userDetails.role || userDetails.position || '';
                
                // Show admin tools only for president
                const adminToolsCard = document.getElementById('adminToolsCard');
                if (adminToolsCard) {
                    if (userRole.toLowerCase() === 'president') {
                        adminToolsCard.style.display = 'block';
                        console.log('Admin tools visible for President');
                    } else {
                        adminToolsCard.style.display = 'none';
                        console.log('Admin tools hidden for non-President role:', userRole);
                    }
                }
            } catch (error) {
                console.error('Error checking user role:', error);
                // Hide admin tools by default if there's an error
                const adminToolsCard = document.getElementById('adminToolsCard');
                if (adminToolsCard) {
                    adminToolsCard.style.display = 'none';
                }
            }
        }

        // Check role when page loads
        document.addEventListener('DOMContentLoaded', function() {
            checkUserRole();
        });
    </script>

    <!-- Financial Data Management -->
    <script src="financial-data.js"></script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>First Year Deposits (2021-2022) - Sri Mukkanneshwara Associate</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <script src="js/auth-utils.js"></script>
    <script>
        (function() {
            // Use new AuthUtils for session validation
            if (window.AuthUtils && window.AuthUtils.isSessionValid()) {
                // Session is valid, continue
                return;
            } else {
                // Clear all session data
                sessionStorage.clear();
                sessionStorage.setItem('returnUrl', window.location.href);
                window.location.href = 'login.html';
            }
        })();
    </script>

    <header>
        <h1>Sri Mukkanneshwara Associate</h1>
        <nav>
            <ul>
                <li><a href="main.html">Overview</a></li>
                <li><a href="members.html">Members</a></li>
                <li><a href="accounts.html">Accounts</a></li>
                <li><a href="meetings.html">Meetings</a></li>
                <li><a href="rules.html">Rules</a></li>
                <li><a href="#" onclick="logout()" style="color: #e74c3c; font-weight: bold;"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section class="deposits-section">
            <h2 class="page-title"><i class="fas fa-piggy-bank"></i> Deposits 2021-22</h2>

            <div class="table-actions" style="margin-bottom: 1rem; text-align: right;">
                <button id="downloadPdfBtn" class="download-btn" onclick="downloadDepositPDF()" title="Download as PDF">
                    <i class="fas fa-download"></i> Download PDF
                </button>
            </div>

            <div class="info-card">
                <h3 class="mt-4">First Year History (2021-2022)</h3>
                <div class="history-summary">
                    <p>In the inaugural year, the association established its financial foundation as follows:</p>
                    <ul class="feature-list">
                        <li>Initial contribution: Each member deposited ₹5,000 in February 2021</li>
                        <li>Regular monthly deposits: ₹1,000 per member from March 2021 to January 2022</li>
                        <li>Special consideration: The President was exempted from December 2021 deposit</li>
                        <li>Additional income: Earned ₹8,700 through interest</li>
                        <li>Annual expenses: ₹5,600 spent on year-end meeting</li>
                    </ul>
                </div>

                <h3 class="mt-4">Detailed First Year Summary</h3>
                <table class="member-table">
                    <thead>
                        <tr>
                            <th>Description</th>
                            <th>Details</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Initial Contribution</td>
                            <td>February 2021 (₹5,000 × 7 members)</td>
                            <td>₹35,000</td>
                        </tr>
                        <tr>
                            <td>Monthly Deposits</td>
                            <td>March 2021 - November 2021 (₹1,000 × 7 members × 9 months)</td>
                            <td>₹63,000</td>
                        </tr>
                        <tr>
                            <td>December 2021</td>
                            <td>6 members (President exempt)</td>
                            <td>₹6,000</td>
                        </tr>
                        <tr>
                            <td>January 2022</td>
                            <td>All 7 members</td>
                            <td>₹7,000</td>
                        </tr>
                        <tr>
                            <td>Interest Earned</td>
                            <td>Total interest for the year</td>
                            <td>₹8,700</td>
                        </tr>
                        <tr>
                            <td>Annual Meeting Expense</td>
                            <td>Year-end meeting cost</td>
                            <td>-₹5,600</td>
                        </tr>
                        <tr class="total-row">
                            <td>Total Balance</td>
                            <td>End of First Year</td>
                            <td>₹114,100</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <a href="deposits.html" style="color: #007bff; text-decoration: none; font-size: 0.9rem;">
                    ← Back to Deposits Overview
                </a>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 Sri Mukkanneshwara Associate. All rights reserved.</p>
    </footer>
    
    <script src="js/pdf-generator.js"></script>
    <script>
        // PDF Download functionality for deposits
        async function downloadDepositPDF() {
            const downloadBtn = document.getElementById('downloadPdfBtn');
            const originalText = downloadBtn.innerHTML;
            
            try {
                // Show loading state
                downloadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating PDF...';
                downloadBtn.disabled = true;
                
                // Get deposit data from the page
                const depositData = getDepositData();
                
                if (depositData.length === 0) {
                    alert('No data available to generate PDF');
                    return;
                }
                
                // Generate PDF
                const success = await PDFGenerator.generateDepositPDF('2021-22', depositData, 'Deposit Records 2021-22');
                
                if (success) {
                    console.log('PDF generated successfully');
                }
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Error generating PDF. Please try again.');
            } finally {
                // Reset button state
                downloadBtn.innerHTML = originalText;
                downloadBtn.disabled = false;
            }
        }
        
        // Function to get deposit data from the page
        function getDepositData() {
            const depositData = [
                {
                    description: 'Initial Contribution',
                    details: 'February 2021 (₹5,000 × 7 members)',
                    amount: '₹35,000'
                },
                {
                    description: 'Monthly Deposits',
                    details: 'March 2021 to January 2022 (₹1,000 × 7 members × 11 months)',
                    amount: '₹77,000'
                },
                {
                    description: 'Interest Earned',
                    details: 'Bank interest on deposits',
                    amount: '₹8,700'
                },
                {
                    description: 'Annual Meeting Expenses',
                    details: 'Year-end meeting costs',
                    amount: '₹5,600'
                },
                {
                    description: 'Total Balance',
                    details: 'End of year balance',
                    amount: '₹1,14,100'
                }
            ];
            
            return depositData;
        }

        // Logout function
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                // Clear all session data
                sessionStorage.clear();
                localStorage.clear();
                
                // Redirect to login page
                window.location.href = 'login.html';
            }
        }
    </script>
</body>
</html>